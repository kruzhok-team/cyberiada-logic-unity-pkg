# CyberiadaLogic
Данный пакет состоит из 4 отдельных модулей:
* **CyberiadaGraph** — модуль, содержащий структуру графа и всех его элементов.
* **Converter** — модуль, предназначенный для конвертации объектов ```CyberiadaGraphDocument``` в документы формата GraphML.
* **LogicBridge** — модуль, обеспечивающий взаимодействие между графами и интерпретатором, который осуществляет исполнение команд, хранимых в графах.
* **EditorCore** — модуль, использующийся как основа для редактирования CyberiadaGraph, а также его визуального представления.

### CyberiadaGraph
В модуле **CyberiadaGraph** описывается структура графа и его элементы.  
Граф состоит из множества узлов и ребер.  
Логика узлов хранится в классах ```Node``` и ```NodeData```, а логика ребер — в классах ```Edge``` и ```EdgeData```.  
Узлы соединены между собой ребрами.  
Узлы могут содержать внутри себя дочерние узлы, таким образом, в **CyberiadaGraph** существует поддержка подграфов.  
Данные, хранимые в узлах и ребрах, тесно связаны с [документацией CyberiadaGraphML](https://docs.google.com/document/d/1eBZu4JDnJ4jh7_NlSFEBC6NL4XTbSMkJQRiPgnT94BA) и интерпретатором, который будет выполнять описываемое данным графом поведение.  
Также внутри элементов графа могут содержаться данные, которые отвечают за визуальное представление графа, например расположение элементов и их названия.

### Converter
Данный модуль отвечает за конвертацию объектов ```CyberiadaGraphDocument``` в файлы в формате GraphML и наоборот.  
**CyberiadaGraphDocument** состоит из корневого графа и различных метаданных, специфичных для конкретной целевой платформы, на которой будет исполняться данный граф.  
Конвертация происходит с использованием библиотеки ```System.Xml.Linq```, которая позволяет удобно работать с GraphML-разметкой.

### LogicBridge
В данном модуле находится набор интерфейсов, которые позволяют определить набор правил для обработки строковых команд интерпретатором.
* ```ICommandBus``` используется для обработки команд.
* ```IVariableBus``` — для переменных.
* ```IEventBus``` — для событий.

### EditorCore
Данный модуль используется для создания пользовательского редактора графов.  
Основной класс данного модуля — ```GraphEditor```, который имеет набор методов для добавления и удаления различных элементов графа, а также перестроения визуального состояния графа.  
```GraphEditor``` изменяет структуру графа и использует интерфейс ```IGraphElementViewFactory``` для изменения визуального представления графа.  
В программах, использующих данный модуль, подразумевается, что пользователь должен реализовать данный интерфейс самостоятельно. Конечная реализация может сильно меняться в зависимости от выбранной графической библиотеки.

## Инструкции по интеграции редактора графов в сторонний проект
### 1. Реализация представлений элементов графа
Необходимо реализовать представления элементов графа: ```IGraphView```, ```INodeView```, ```INodeEventView```, ```INodeActionView```, ```IEdgeView```, ```IEdgeActionView```.
* ```IGraphView``` — представление графа.
* ```INodeView``` — представление узла.
* ```INodeEventView``` — представление состояния узла.
* ```INodeActionView``` — представление поведения узла.
* ```IEdgeView``` — представление ребра.
* ```IEdgeActionView``` — представление поведения ребра.

### 2. Реализация фабрики представлений элементов графа
Необходимо реализовать интерфейс ```IGraphElementViewFactory```. Данный интерфейс позволяет управлять циклом жизни создаваемых представлений: создавать и удалять представления элементов графа.  
Список методов, реализуемых данным интерфейсом:
* ```IGraphView CreateGraphView(string graphID, INodeView parentNodeView)``` — создает представление графа.
* ```NodeView CreateNodeView(NodeVisualData visualData, string vertex, bool layoutAutomatically)``` — создает новое представление узла.
* ```INodeEventView CreateNodeEventView(INodeView nodeView, string triggerID, Event @event)``` — создает представление состояния.
* ```INodeActionView CreateNodeActionView(INodeEventView eventView, string actionID)``` — создает представление поведения в переходе для узла.
* ```IEdgeView CreateEdgeView(INodeView sourceNode, INodeView targetNode, EdgeVisualData edgeVisualData, string triggerID, string condition)``` — создает представление ребра.
* ```IEdgeActionView CreateEdgeActionView(IEdgeView edgeView, string actionID)``` — создает представление поведения в переходе для ребра.
* ```void DestroyElementView(IGraphElementView view)``` — разрушает представление элемента графа.

### 3. Создание источника контекста выполнения
Для того чтобы задать события, поведения и условия, которые будут поддерживаться целевой платформой, необходимо создать источник контекста выполнения.  
Источник контекста выполнения можно реализовать с использованием интерфейса ```IExecutionContextSource```.  
Данный интерфейс позволяет получить весь контекст в виде множества строк.
* ```IEnumerable<string> GetEvents()``` — возвращает все события, поддерживаемые интерпретатором.
* ```IEnumerable<string> GetActions()``` — возвращает все поведение, поддерживаемое интерпретатором.
* ```IEnumerable<string> GetVariables()``` — возвращает все переменные, поддерживаемые интерпретатором.

### 4. Создание клиентского класса ```MyGraphEditor```
В качестве зависимости в такой ```MyGraphEditor``` необходимо передать ранее созданную фабрику представлений ```IGraphElementViewFactory```, источник контекста выполнения ```IExecutionContextSource```, а также ```GraphEditor``` и любой ```CyberiadaGraph```.  
В нем необходимо написать методы создания и удаления элементов графа, делегировав их ```GraphEditor```.  
Редактирование элементов графа можно реализовать через использование методов ```SetCondition```, ```SetTrigger```, ```SetParameters```, которые находятся внутри интерфейсов представления элементов графа.  
Для добавления возможности выбора редактируемого значения можно воспользоваться ```IExecutionContextSource```.  
Для сохранения и загрузки графов можно воспользоваться модулем **Converter**.

## © 2024 Кружковое движение  
